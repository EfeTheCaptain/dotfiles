#!/bin/bash

# Get search query
query=$(dmenu -p "ðŸ”Ž Search YouTube:" -l 1 < /dev/null)
[ -z "$query" ] && exit

# Get titles (max 5 results)
titles=$(yt-dlp --flat-playlist --default-search "ytsearch" --max-downloads 5 -j "$query" 2>/dev/null | jq -r '.title')

# Exit if no results
[ -z "$titles" ] && notify-send "YT Audio" "No results found" && exit

# Select title
selected_title=$(echo "$titles" | dmenu -l 5 -i -p "Results:")

# Get and play URL
if [ -n "$selected_title" ]; then
    url=$(yt-dlp --flat-playlist --default-search "ytsearch" -j "$query" | \
          jq -r --arg title "$selected_title" 'select(.title == $title) | .webpage_url')
    [ -n "$url" ] && mpv --no-video --vo=null --ao=alsa \
        --demuxer-max-bytes=20MiB \
        --demuxer-max-back-bytes=4MiB \
        "$url"
fi
